{% extends "base.html" %} {% block content %}
<div class="card">
  <div class="card-header">
    <h2>Connect to Peer</h2>
  </div>
  <div class="card-body">
    <form id="connectForm" onsubmit="return connectToPeer(event)">
      <div class="mb-3">
        <label for="peer_ip" class="form-label">Peer IP Address</label>
        <input
          type="text"
          class="form-control"
          id="peer_ip"
          name="peer_ip"
          required
          placeholder="Enter peer's IP address (e.g., 192.168.1.100)"
        />
      </div>
      <button type="submit" class="btn btn-primary">Connect</button>
    </form>
    <div id="connectionStatus" class="mt-3"></div>
  </div>
</div>

<script>
  async function connectToPeer(event) {
    event.preventDefault();
    const peerIp = document.getElementById("peer_ip").value;
    const statusDiv = document.getElementById("connectionStatus");

    try {
      const response = await fetch("/connect", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: `peer_ip=${encodeURIComponent(peerIp)}`,
      });

      const data = await response.json();

      if (response.ok) {
        statusDiv.innerHTML = `
                <div class="alert alert-success">
                    Successfully connected to peer at ${peerIp}
                </div>
            `;
      } else {
        statusDiv.innerHTML = `
                <div class="alert alert-danger">
                    Failed to connect: ${data.error}
                </div>
            `;
      }
    } catch (error) {
      statusDiv.innerHTML = `
            <div class="alert alert-danger">
                Error: Could not connect to peer
            </div>
        `;
    }

    return false;
  }
</script>
{% endblock %}
